<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAA Part 107 Study App</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --star-color: #fbbf24;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 { margin: 0; font-size: 1.5rem; }
        .subtitle { font-size: 0.9rem; opacity: 0.9; margin-top: 0.25rem; }

        /* Main Layout */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* Controls Area */
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        button, select, input {
            background-color: white;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-main);
            transition: all 0.2s;
            font-size: 0.9rem;
            font-family: inherit;
        }

        input {
            cursor: text;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 1rem;
        }

        button:hover, select:hover { background-color: #f9fafb; transform: translateY(-1px); }
        button:active, select:active { transform: translateY(0); }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.primary {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        button.primary:hover { background-color: var(--primary-dark); }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 999px;
            height: 0.75rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Flashcard Container (3D Flip Effect) */
        .card-scene {
            width: 100%;
            max-width: 700px;
            height: 500px;
            perspective: 1000px;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 1rem;
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: var(--card-bg);
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem 1.5rem 1.5rem 1.5rem;
            box-sizing: border-box;
            text-align: center;
            border: 1px solid #e5e7eb;
            overflow-y: auto;
        }

        .card-face.back {
            transform: rotateY(180deg);
            background-color: #fefffa;
        }

        .category-tag {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            z-index: 10;
        }

        /* Star Button Styling */
        .star-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            color: #d1d5db; /* Grey by default */
            cursor: pointer;
            z-index: 20;
            padding: 0;
            line-height: 1;
            transition: color 0.2s, transform 0.1s;
        }
        .star-btn:hover {
            transform: scale(1.1);
            background: none;
        }
        .star-btn.starred {
            color: var(--star-color);
        }

        /* ACS Code Styling */
        .acs-tag {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            font-size: 0.7rem;
            color: var(--text-muted);
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .card-content {
            font-size: 1.25rem;
            line-height: 1.5;
            max-width: 100%;
            margin-bottom: 1rem;
        }

        /* Image Styling */
        .card-image-container {
            max-width: 100%;
            max-height: 250px;
            margin: 1rem 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            display: none;
        }

        .card-image {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 250px;
            object-fit: contain;
            cursor: zoom-in;
        }
        
        .answer-text {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.35rem;
            margin-bottom: 1rem;
        }

        .explanation-text {
            font-size: 1rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .click-hint {
            margin-top: auto;
            font-size: 0.8rem;
            color: #9ca3af;
            padding-top: 1rem;
        }

        /* Quiz Mode Specifics */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            width: 100%;
        }
        
        .quiz-btn {
            background-color: white;
            border: 2px solid #e5e7eb;
            padding: 1rem;
            text-align: left;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        .quiz-btn:hover { border-color: var(--primary); background-color: #eff6ff; }
        
        .quiz-btn.correct { background-color: #dcfce7; border-color: var(--success); color: #14532d; }
        .quiz-btn.incorrect { background-color: #fee2e2; border-color: var(--danger); color: #7f1d1d; }

        /* Action Buttons */
        .action-area {
            display: flex;
            gap: 1rem;
            width: 100%;
            max-width: 700px;
            justify-content: space-between;
        }

        .action-btn {
            flex: 1;
            padding: 1rem;
            border-radius: 0.75rem;
            border: none;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-wrong { background-color: var(--warning); }
        .btn-wrong:hover { background-color: #d97706; }
        
        .btn-right { background-color: var(--success); }
        .btn-right:hover { background-color: #15803d; }

        /* Link Buttons (Report) */
        .btn-link {
            background: none !important;
            border: none !important;
            color: var(--text-muted) !important;
            text-decoration: underline;
            font-size: 0.85rem !important;
            padding: 0.5rem !important;
            cursor: pointer;
        }
        .btn-link:hover {
            color: var(--primary) !important;
            background: none !important;
            transform: none !important;
        }

        .hidden { display: none !important; }

        /* Stats */
        .stats {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            width: 100%;
            max-width: 600px;
        }

        /* Image Modal (Zoom) */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.9);
        }
        .modal-content {
            margin: auto;
            display: block;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            object-fit: contain;
            margin-top: 2rem;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }

        /* Report Modal & Login Modal Shared */
        #reportModal .modal-box, #loginModal .modal-box {
            background: white; 
            margin: 5% auto; 
            padding: 2rem; 
            width: 90%; 
            max-width: 500px; 
            border-radius: 8px; 
            position: relative;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        #reportText {
            width: 100%; 
            height: 300px; 
            margin-bottom: 1rem; 
            padding: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
        }
        
        /* Login specific */
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-main);
            text-align: left;
        }

    </style>
</head>
<body>

<header>
    <h1>‚úàÔ∏è FAA Part 107 Prep</h1>
    <div class="subtitle">Offline Study Companion</div>
</header>

<main>
    <!-- Navigation/Mode Controls -->
    <div class="controls">
        <select id="subjectSelect" onchange="applyFilters()">
            <option value="ALL">All Subjects (Mix)</option>
            <option value="STARRED">‚òÖ Starred Questions</option>
        </select>

        <select id="countSelect" onchange="applyFilters()">
            <option value="10">10 Questions</option>
            <option value="25">25 Questions</option>
            <option value="50">50 Questions</option>
            <option value="ALL" selected>All Questions</option>
        </select>

        <button id="modeToggleBtn" onclick="toggleMode()">Switch to Quiz Mode</button>
        <button id="reviewBtn" onclick="toggleReview()">Review Weak Areas (0)</button>
        <button onclick="generateReport()" style="color: #4f46e5; border-color: #4f46e5;">‚úâÔ∏è Email Report</button>
        <button onclick="resetProgress()" style="color: var(--danger); border-color: var(--danger);">Reset Progress</button>
        <button id="prevBtn" onclick="prevCard()" style="border-style: dashed;">‚Üê Previous</button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
    </div>

    <!-- FLASHCARD MODE -->
    <div id="flashcardMode">
        <div class="card-scene" onclick="flipCard(event)">
            <div class="card" id="flashcard">
                <!-- Front -->
                <div class="card-face front">
                    <span class="category-tag" id="fcCategory">Category</span>
                    <!-- Star Button -->
                    <button class="star-btn" id="fcStarBtn" onclick="toggleStar(event)">‚òÜ</button>
                    
                    <div class="card-image-container" id="fcImgContainer">
                        <img src="" alt="Question Image" class="card-image" id="fcImg" onclick="openModal(event)">
                    </div>

                    <div class="card-content" id="fcQuestion">Question goes here...</div>
                    <div class="acs-tag" id="fcAcs">ACS: ---</div>
                    <div class="click-hint">Click to flip</div>
                </div>
                
                <!-- Back -->
                <div class="card-face back">
                    <span class="category-tag" id="fcCategoryBack">Category</span>
                    <button class="star-btn" id="fcStarBtnBack" onclick="toggleStar(event)">‚òÜ</button>
                    <div class="answer-text" id="fcAnswer">Answer goes here</div>
                    <div class="explanation-text" id="fcExplanation">Explanation goes here...</div>
                    <div class="acs-tag" id="fcAcsBack">ACS: ---</div>
                </div>
            </div>
        </div>

        <div class="action-area" id="fcActions" style="visibility: hidden;">
            <button class="action-btn btn-wrong" onclick="recordResult(false); nextCard();">Needs Review ‚Ü∫</button>
            <button class="action-btn btn-right" onclick="recordResult(true); nextCard();">Got It! ‚úì</button>
        </div>

        <!-- Report Issue Button -->
        <div style="text-align: center; margin-top: 1rem;">
            <button onclick="reportCurrentCard()" class="btn-link">üö© Report Issue with this Card</button>
        </div>
    </div>

    <!-- QUIZ MODE -->
    <div id="quizMode" class="hidden" style="width: 100%; max-width: 700px;">
        <div style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative;">
            <span class="category-tag" id="qzCategory" style="position:relative; top:0; left:0; margin-bottom:1rem; display:inline-block;">Category</span>
            <button class="star-btn" id="qzStarBtn" onclick="toggleStar(event)" style="top: 1.5rem; right: 1.5rem;">‚òÜ</button>
            
            <div class="card-image-container" id="qzImgContainer" style="display:none; max-height: 300px; margin-bottom: 1rem;">
                <img src="" alt="Quiz Image" class="card-image" id="qzImg" onclick="openModal(event)">
            </div>

            <div style="font-size: 1.2rem; margin-bottom: 1.5rem;" id="qzQuestion">Question...</div>
            <div class="quiz-options" id="qzOptions">
                <!-- Options injected by JS -->
            </div>
            <div id="qzFeedback" style="margin-top: 1.5rem; display: none;">
                <div id="qzFeedbackText" style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem;"></div>
                <div id="qzExplanation" class="explanation-text"></div>
                <button class="primary" onclick="nextCard()" style="margin-top: 1rem; width: 100%;">Next Question ‚Üí</button>
            </div>
            
            <div class="acs-tag" id="qzAcs" style="position: relative; bottom: auto; right: auto; display: inline-block; margin-top: 1rem;">ACS: ---</div>

            <!-- Report Issue Button -->
            <div style="text-align: center; margin-top: 2rem; border-top: 1px solid #eee; padding-top: 1rem;">
                <button onclick="reportCurrentCard()" class="btn-link">üö© Report Issue with this Question</button>
            </div>
        </div>
    </div>

    <div class="stats">
        Cards Mastered: <span id="masteredCount">0</span> / <span id="totalCount">0</span>
    </div>
</main>

<!-- Image Zoom Modal -->
<div id="imageModal" class="modal" onclick="closeModal()">
    <span class="close-modal">&times;</span>
    <img class="modal-content" id="modalImg">
</div>

<!-- Login / Class Setup Modal -->
<div id="loginModal" class="modal" style="display:none; background-color: rgba(0,0,0,0.85); align-items:center; justify-content:center;">
    <div class="modal-box">
        <h2 style="margin-top: 0; text-align: center; color: var(--primary);">Classroom Sign In</h2>
        <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">Please enter your details to start studying.</p>
        
        <label for="inputName">Student Name:</label>
        <input type="text" id="inputName" placeholder="First and Last Name">
        
        <label for="inputClass">Class Name / Period:</label>
        <input type="text" id="inputClass" placeholder="e.g. Period 2 Drone Ops">
        
        <label for="inputEmail">Teacher Email (for Reports):</label>
        <input type="email" id="inputEmail" placeholder="teacher@email.com">
        
        <button class="primary" onclick="startSession()" style="margin-top: 1rem; padding: 0.75rem;">Start Studying üöÄ</button>
    </div>
</div>

<!-- Report Modal -->
<div id="reportModal" class="modal" style="display:none; background-color: rgba(0,0,0,0.5);">
    <div class="modal-box">
        <span onclick="closeReportModal()" style="position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 1.5rem;">&times;</span>
        <h2 id="reportTitle" style="margin-top: 0;">Study Session Report</h2>
        <p style="font-size: 0.9rem; color: #555;">Your email client should open automatically. If not, copy the text below and email it to <strong id="reportEmailDisplay"></strong>.</p>
        <textarea id="reportText" readonly></textarea>
        <div style="display:flex; gap: 10px;">
            <button class="primary" onclick="copyToClipboard()" style="flex:1;">Copy to Clipboard</button>
            <button onclick="closeReportModal()" style="flex:1;">Close</button>
        </div>
    </div>
</div>

<script>
    /* INSTRUCTIONS FOR ADDING IMAGES:
       1. Place your image files (jpg/png) in a folder named 'images' next to this file.
       2. Add the filename to the 'img' property in the questionData below.
       3. Example: img: "images/figure23.jpg"
    */

    const demoImage = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMDAgMTUwIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2IyMDIwMiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkeT0iLjM1ZW0iIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSI2MCIgZm9udC13ZWlnaHQ9ImJvbGQiPjE1LTMzPC90ZXh0Pjwvc3ZnPg==";

    // --- DATA: FAA Part 107 Questions (Expanded Question Bank with ACS) ---
    const questionData = [
        // --- REGULATIONS (Core) ---
        { id: 1, category: "Regulations", acs: "UA.I.B.K21", question: "According to 14 CFR Part 107, what is the maximum groundspeed for a small UA?", options: ["87 knots (100 mph)", "100 knots (115 mph)", "80 knots (90 mph)"], answer: "87 knots (100 mph)", explanation: "Section 107.51 states the maximum groundspeed is 87 knots (100 miles per hour).", img: null },
        { id: 2, category: "Regulations", acs: "UA.I.A.K1", question: "When must a person register a small UA with the FAA?", options: ["If it weighs > 0.55 lbs", "If used commercially", "All of the above"], answer: "If it weighs > 0.55 lbs", explanation: "All sUAS weighing more than 0.55 lbs (250g) and less than 55 lbs must be registered.", img: null },
        { id: 3, category: "Regulations", acs: "UA.I.B.K8", question: "How many hours must pass between consuming alcohol and operating a small UA?", options: ["8 hours", "12 hours", "24 hours"], answer: "8 hours", explanation: "14 CFR Part 107.27 prohibits operation within 8 hours of consuming alcohol ('Bottle to Throttle').", img: null },
        { id: 4, category: "Regulations", acs: "UA.I.B.K8", question: "What is the blood alcohol concentration (BAC) limit for a remote pilot?", options: ["0.04%", "0.08%", "0.00%"], answer: "0.04%", explanation: "A remote pilot may not operate if they have a BAC of 0.04% or greater.", img: null },
        { id: 5, category: "Regulations", acs: "UA.I.B.K6", question: "A small UA must be operated in a manner which does not endanger the life or property of another. This is known as:", options: ["Careless or Reckless Operation", "Standard Operating Procedure", "Risk Management"], answer: "Careless or Reckless Operation", explanation: "Section 107.23 prohibits careless or reckless operation.", img: null },
        { id: 6, category: "Regulations", acs: "UA.I.B.K9", question: "To operate at night (after sunset), your drone must be equipped with:", options: ["Anti-collision lights visible for 3 statute miles", "Navigation lights", "Infrared camera"], answer: "Anti-collision lights visible for 3 statute miles", explanation: "Operations at night or civil twilight require anti-collision lights visible for at least 3 SM.", img: null },
        { id: 7, category: "Regulations", acs: "UA.I.A.K1", question: "What is the minimum age to register a drone?", options: ["13 years old", "16 years old", "18 years old"], answer: "13 years old", explanation: "You must be 13 to register a drone. You must be 16 to take the Part 107 test.", img: null },
        { id: 8, category: "Regulations", acs: "UA.I.A.K2", question: "How often must a remote pilot pass a recurrent knowledge test or training?", options: ["Every 24 calendar months", "Every 12 months", "Every 5 years"], answer: "Every 24 calendar months", explanation: "Recurrent training/testing is required every 24 calendar months to keep currency.", img: null },
        { id: 9, category: "Regulations", acs: "UA.I.B.K3", question: "If you change your address, you must notify the FAA within:", options: ["30 days", "10 days", "90 days"], answer: "30 days", explanation: "Certificate holders must notify the FAA of an address change within 30 days.", img: null },
        { id: 10, category: "Regulations", acs: "UA.I.A.K1", question: "The maximum weight of a small unmanned aircraft under Part 107 is:", options: ["Less than 55 lbs", "55 lbs exactly", "25 kgs"], answer: "Less than 55 lbs", explanation: "The aircraft must weigh less than 55 lbs (up to 54.99 lbs) at takeoff.", img: null },
        { id: 11, category: "Regulations", acs: "UA.I.B.K21", question: "What is the minimum visibility required to fly a sUAS?", options: ["3 Statute Miles", "1 Statute Mile", "5 Statute Miles"], answer: "3 Statute Miles", explanation: "Part 107.51 requires at least 3 statute miles of visibility from the control station.", img: null },
        { id: 12, category: "Regulations", acs: "UA.I.B.K21", question: "What is the minimum distance you must stay below clouds?", options: ["500 feet", "1000 feet", "2000 feet"], answer: "500 feet", explanation: "You must remain at least 500 feet below clouds.", img: null },
        { id: 13, category: "Regulations", acs: "UA.I.B.K21", question: "What is the minimum horizontal distance you must stay from clouds?", options: ["2000 feet", "500 feet", "1 mile"], answer: "2000 feet", explanation: "You must remain at least 2000 feet horizontally from clouds.", img: null },
        { id: 14, category: "Regulations", acs: "UA.I.B.K22", question: "Who is responsible for ensuring the sUAS is in safe operating condition?", options: ["Remote Pilot in Command", "Owner", "Visual Observer"], answer: "Remote Pilot in Command", explanation: "The Remote PIC is responsible for the preflight check and safe operation.", img: null },
        { id: 15, category: "Regulations", acs: "UA.I.A.K3", question: "Can a foreign-registered drone be operated under Part 107?", options: ["Only if the operator holds a US Remote Pilot Certificate and the drone is registered in the US", "No, never", "Yes, automatically"], answer: "Only if the operator holds a US Remote Pilot Certificate and the drone is registered in the US", explanation: "To operate under Part 107, the pilot must have the certificate and the drone must be registered with the FAA.", img: null },
        { id: 16, category: "Regulations", acs: "UA.I.B.K19", question: "When can you fly over a person?", options: ["If they are a direct participant or under a covered structure/vehicle", "If they sign a waiver", "Never"], answer: "If they are a direct participant or under a covered structure/vehicle", explanation: "Part 107.39 restricts flight over human beings unless they are participants or protected.", img: null },
        { id: 17, category: "Regulations", acs: "UA.I.B.K19", question: "Which Category of Operations Over People requires a 'Declaration of Compliance'?", options: ["Category 2 and 3", "Category 1", "Category 4"], answer: "Category 2 and 3", explanation: "Categories 2 and 3 require an FAA-accepted Declaration of Compliance from the manufacturer.", img: null },
        { id: 18, category: "Regulations", acs: "UA.I.B.K19", question: "Category 1 operations over people allow drones weighing:", options: ["0.55 lbs or less", "Up to 55 lbs", "Over 0.55 lbs"], answer: "0.55 lbs or less", explanation: "Category 1 is for drones weighing 0.55 pounds or less with no exposed rotating parts that would cause injury.", img: null },
        { id: 19, category: "Regulations", acs: "UA.I.B.K23", question: "What does Remote ID require?", options: ["Broadcast of ID and location info", "A transponder", "ADS-B Out"], answer: "Broadcast of ID and location info", explanation: "Remote ID requires the drone to broadcast identity, location, and control station location.", img: null },
        { id: 20, category: "Regulations", acs: "UA.I.B.K7", question: "Can you carry hazardous material (HazMat) on a drone under Part 107?", options: ["No", "Yes, with a waiver", "Yes, if < 1 lb"], answer: "No", explanation: "Carriage of hazardous materials is prohibited under Part 107.", img: null },
        { id: 21, category: "Regulations", acs: "UA.I.B.K10", question: "If a Visual Observer (VO) is used, who must maintain VLOS?", options: ["Both the PIC and VO", "Just the VO", "Just the PIC"], answer: "Both the PIC and VO", explanation: "The PIC must always be capable of VLOS, and the VO assists.", img: null },
        { id: 22, category: "Regulations", acs: "UA.I.B.K5", question: "When operating from a moving vehicle, you may:", options: ["Only fly over sparsely populated areas", "Fly over cities", "Never fly"], answer: "Only fly over sparsely populated areas", explanation: "Operation from a moving land vehicle is allowed only in sparsely populated areas.", img: null },
        { id: 23, category: "Regulations", acs: "UA.I.B.K5", question: "Can you operate from a moving aircraft?", options: ["No", "Yes", "With a waiver"], answer: "No", explanation: "Part 107 prohibits operating a drone from a moving aircraft.", img: null },
        { id: 24, category: "Regulations", acs: "UA.I.B.K5", question: "Are you allowed to transport property for compensation (delivery)?", options: ["Yes, if total weight <55 lbs and within VLOS", "No", "Only in rural areas"], answer: "Yes, if total weight <55 lbs and within VLOS", explanation: "Part 107 allows package delivery if within VLOS, not from a moving vehicle (unless sparse area), and <55lbs.", img: null },
        { id: 25, category: "Regulations", acs: "UA.I.C.K2", question: "Conviction for growing marijuana results in:", options: ["Denial of application for 1 year", "Lifetime ban", "No effect"], answer: "Denial of application for 1 year", explanation: "A drug conviction results in a 1-year denial of application or suspension.", img: null },

        // --- AIRSPACE ---
        { id: 26, category: "Airspace", acs: "UA.I.B.K21", question: "What is the maximum altitude allowed for sUAS operations (without a waiver)?", options: ["400 feet AGL", "500 feet AGL", "1000 feet MSL"], answer: "400 feet AGL", explanation: "You may not fly higher than 400 feet Above Ground Level (AGL), unless within 400 feet of a structure.", img: null },
        { id: 27, category: "Airspace", acs: "UA.II.A.K1", question: "What type of airspace requires ATC authorization before entering?", options: ["Class B, C, D, and Surface E", "Class G", "Class E (at 700 ft)"], answer: "Class B, C, D, and Surface E", explanation: "Controlled airspace (B, C, D, E Surface) requires prior authorization (usually via LAANC).", img: null },
        { id: 28, category: "Airspace", acs: "UA.II.A.K1", question: "Class C airspace typically consists of:", options: ["Surface area (5NM radius) and Shelf (10NM radius)", "A single 5NM circle", "An upside down wedding cake with 3 layers"], answer: "Surface area (5NM radius) and Shelf (10NM radius)", explanation: "Class C usually has a surface area (5NM) and an outer shelf (10NM) extending from 1,200ft to 4,000ft.", img: null },
        { id: 29, category: "Airspace", acs: "UA.II.A.K1", question: "The 'floor' of Class E airspace indicated by a shaded magenta line is:", options: ["700 feet AGL", "1200 feet AGL", "Surface"], answer: "700 feet AGL", explanation: "Shaded Magenta = Class E starts at 700 ft AGL. (Shaded Blue = 1200 ft AGL).", img: null },
        { id: 30, category: "Airspace", acs: "UA.II.A.K2", question: "(Refer to Figure 25 in supplement) What airspace is Cooperstown Airport in?", options: ["Class G", "Class D", "Class E"], answer: "Class G", explanation: "Cooperstown is typically in uncontrolled Class G airspace up to 700 or 1200 AGL.", img: null },
        { id: 31, category: "Airspace", acs: "UA.II.A.K1", question: "What does a dashed magenta line around an airport indicate?", options: ["Class E Surface Area", "Class D Airspace", "Class G Airspace"], answer: "Class E Surface Area", explanation: "Dashed Magenta indicates Class E airspace starting at the surface. Authorization is required.", img: null },
        { id: 32, category: "Airspace", acs: "UA.II.A.K3", question: "Restricted Areas (R-xxxx) denote:", options: ["Unusual, often invisible hazards (artillery, missiles)", "Military training routes", "Parachute jump areas"], answer: "Unusual, often invisible hazards (artillery, missiles)", explanation: "Restricted areas contain hazards like artillery firing. You need permission from the controlling agency to enter when active.", img: null },
        { id: 33, category: "Airspace", acs: "UA.II.A.K3", question: "Military Training Routes (MTRs) with 4 numbers (e.g., VR1234) are flown at:", options: ["At or below 1500 ft AGL", "Above 1500 ft AGL", "Only above 10,000 ft"], answer: "At or below 1500 ft AGL", explanation: "4 digits = Below 1500 AGL. 3 digits = Above 1500 AGL.", img: null },
        { id: 34, category: "Airspace", acs: "UA.I.B.K21", question: "You are flying near a tower marked '1000 (400)'. How high can you fly over it?", options: ["800 feet AGL", "400 feet AGL", "You cannot fly over it"], answer: "800 feet AGL", explanation: "Part 107 allows you to fly 400ft above a structure. If structure is 400ft tall, you can fly to 800ft AGL directly over it.", img: null },
        { id: 35, category: "Airspace", acs: "UA.II.A.K1", question: "What airspace is Class G?", options: ["Uncontrolled", "Controlled", "Special Use"], answer: "Uncontrolled", explanation: "Class G is uncontrolled airspace. No ATC authorization is required.", img: null },
        { id: 36, category: "Airspace", acs: "UA.II.A.K1", question: "Class B airspace is indicated on the chart by:", options: ["Solid Blue Lines", "Solid Magenta Lines", "Dashed Blue Lines"], answer: "Solid Blue Lines", explanation: "Solid Blue lines denote Class B (Bravo) airspace.", img: null },
        { id: 37, category: "Airspace", acs: "UA.II.A.K1", question: "Class D airspace is indicated on the chart by:", options: ["Dashed Blue Lines", "Dashed Magenta Lines", "Solid Blue Lines"], answer: "Dashed Blue Lines", explanation: "Dashed Blue lines denote Class D (Delta) airspace.", img: null },
        { id: 38, category: "Airspace", acs: "UA.II.A.K3", question: "Prohibited Areas (P-xxxx) mean:", options: ["Flight is prohibited", "Flight is allowed with permission", "Military training"], answer: "Flight is prohibited", explanation: "Flight in Prohibited areas (e.g., Camp David) is strictly forbidden.", img: null },
        { id: 39, category: "Airspace", acs: "UA.II.A.K3", question: "An Alert Area (A-xxxx) signifies:", options: ["High volume of pilot training or unusual activity", "Missile firing", "No flight allowed"], answer: "High volume of pilot training or unusual activity", explanation: "Alert areas contain high volumes of training. Pilots should be alert but entry is not restricted.", img: null },
        { id: 40, category: "Airspace", acs: "UA.II.A.K3", question: "A Warning Area (W-xxxx) is usually found:", options: ["Over domestic waters (3NM outward)", "Over land", "Around airports"], answer: "Over domestic waters (3NM outward)", explanation: "Warning areas are airspace of defined dimensions, extending from 3 nautical miles outward from the coast.", img: null },
        { id: 41, category: "Airspace", acs: "UA.II.A.K2", question: "What indicates the 'Ceiling' of Class D airspace in brackets, e.g., [25]?", options: ["2,500 feet MSL", "250 feet AGL", "2,500 feet AGL"], answer: "2,500 feet MSL", explanation: "Numbers in brackets indicate the ceiling of the airspace in hundreds of feet MSL.", img: null },
        { id: 42, category: "Airspace", acs: "UA.II.A.K2", question: "If the ceiling number in brackets has a minus sign [-25], it means:", options: ["Up to but not including 2,500 MSL", "Up to and including 2,500 MSL", "Below 25 feet"], answer: "Up to but not including 2,500 MSL", explanation: "A minus sign means the airspace extends up to but does not include that altitude.", img: null },
        { id: 43, category: "Airspace", acs: "UA.I.B.K23", question: "Which airspace requires a transponder (Mode C/ADS-B)?", options: ["Class B and C", "Class D", "Class G"], answer: "Class B and C", explanation: "Class B and C (and above 10k ft) require transponders for manned aircraft, though drones often just need authorization.", img: null },
        { id: 44, category: "Airspace", acs: "UA.II.A.K2", question: "The height of an obstruction is shown as 1234 (400). What is 1234?", options: ["MSL height", "AGL height", "Distance"], answer: "MSL height", explanation: "The top number is Mean Sea Level (MSL). The number in parentheses is Above Ground Level (AGL).", img: null },
        { id: 45, category: "Airspace", acs: "UA.II.A.K2", question: "What does a flag symbol on a sectional chart indicate?", options: ["Visual Checkpoint (VFR Checkpoint)", "Airport", "Obstruction"], answer: "Visual Checkpoint (VFR Checkpoint)", explanation: "Flags mark visual checkpoints used by manned pilots to report location.", img: null },
        { id: 46, category: "Airspace", acs: "UA.II.A.K2", question: "A tick mark on an airport symbol indicates:", options: ["Fuel is available", "It is abandoned", "It is private"], answer: "Fuel is available", explanation: "Tick marks around the airport circle indicate fuel is available during normal hours.", img: null },
        { id: 47, category: "Airspace", acs: "UA.II.A.K2", question: "An airport symbol with an 'R' implies:", options: ["Private/Restricted", "Runway lighted", "Radar services"], answer: "Private/Restricted", explanation: "An 'R' in the circle (or specifically described) usually denotes a private or restricted airport.", img: null },
        { id: 48, category: "Airspace", acs: "UA.II.A.K3", question: "What is a TRSA (Terminal Radar Service Area)?", options: ["Voluntary radar service area", "Mandatory Class B", "Prohibited area"], answer: "Voluntary radar service area", explanation: "TRSA provides radar services but participation is voluntary for VFR pilots (solid grey lines).", img: null },
        { id: 49, category: "Airspace", acs: "UA.II.A.K3", question: "Can you fly in a MOA (Military Operations Area)?", options: ["Yes, but exercise extreme caution", "No, never", "Only with ATC permission"], answer: "Yes, but exercise extreme caution", explanation: "VFR flights (including drones) can fly in an MOA without clearance, but it is dangerous due to military training.", img: null },
        { id: 50, category: "Airspace", acs: "UA.II.A.K1", question: "Class E airspace starting at 1200 ft AGL is depicted by:", options: ["Shaded Blue Line (Vignette)", "Shaded Magenta Line", "Dashed Blue Line"], answer: "Shaded Blue Line (Vignette)", explanation: "Shaded Blue indicates Class E starts at 1200 ft AGL (Transition area).", img: null },

        // --- AIRPORT OPS ---
        { id: 51, category: "Airport Ops", acs: "UA.V.B.K3", question: "Refer to the image. What does this sign indicate?", options: ["Runway Holding Position", "Taxiway Location", "Runway Approach Area"], answer: "Runway Holding Position", explanation: "Red background with white text indicates a mandatory instruction, specifically a Runway Holding Position. Stop here unless cleared.", img: demoImage },
        { id: 52, category: "Airport Ops", acs: "UA.V.A.K3", question: "Which leg of the traffic pattern is flown parallel to the runway, opposite the direction of landing?", options: ["Downwind leg", "Base leg", "Crosswind leg"], answer: "Downwind leg", explanation: "The Downwind leg is flown parallel to the landing runway in the opposite direction.", img: null },
        { id: 53, category: "Airport Ops", acs: "UA.V.A.K3", question: "The standard direction of turns in a traffic pattern is:", options: ["Left", "Right", "Straight in"], answer: "Left", explanation: "Standard traffic patterns use left turns unless visual markings or the Chart Supplement indicate otherwise.", img: null },
        { id: 54, category: "Airport Ops", acs: "UA.V.B.K1", question: "What is the frequency usually used at a non-towered airport for pilots to self-announce?", options: ["CTAF (Common Traffic Advisory Frequency)", "UNICOM", "AWOS"], answer: "CTAF (Common Traffic Advisory Frequency)", explanation: "CTAF is used for self-announcing position and intentions at non-towered airports.", img: null },
        { id: 55, category: "Airport Ops", acs: "UA.V.A.K3", question: "A runway marked '9' is oriented toward which magnetic direction?", options: ["090 degrees (East)", "009 degrees", "180 degrees"], answer: "090 degrees (East)", explanation: "Runways are numbered by their magnetic heading divided by 10. Runway 9 = 090 degrees.", img: null },
        { id: 56, category: "Airport Ops", acs: "UA.I.B.K16", question: "Who has the right of way?", options: ["Manned Aircraft", "The sUAS", "Whichever is on the right"], answer: "Manned Aircraft", explanation: "sUAS must always yield right of way to all manned aircraft.", img: null },
        { id: 57, category: "Airport Ops", acs: "UA.V.B.K1", question: "If you hear 'Traffic 10 o'clock', where should you look?", options: ["Front-Left", "Front-Right", "Directly Behind"], answer: "Front-Left", explanation: "12 o'clock is straight ahead. 9 o'clock is left. 10 o'clock is slightly left.", img: null },
        { id: 58, category: "Airport Ops", acs: "UA.V.C.K1", question: "How should you scan for traffic?", options: ["Short, regularly spaced eye movements", "Continuous sweeping motion", "Focus on the horizon"], answer: "Short, regularly spaced eye movements", explanation: "Focus on different segments of the sky for short intervals (10 degrees at a time).", img: null },
        { id: 59, category: "Airport Ops", acs: "UA.V.C.K1", question: "Most mid-air collisions occur during:", options: ["Clear days near airports", "Night time", "Foggy weather"], answer: "Clear days near airports", explanation: "Most collisions happen in good VFR weather, often near airports/navaids.", img: null },
        { id: 60, category: "Airport Ops", acs: "UA.V.B.K1", question: "A remote pilot operating near a non-towered airport should:", options: ["Monitor the CTAF frequency", "Call the nearest tower", "Fly immediately to 400ft"], answer: "Monitor the CTAF frequency", explanation: "It is best practice (though not strictly mandatory if no radio) to monitor CTAF for situational awareness.", img: null },
        { id: 61, category: "Airport Ops", acs: "UA.V.B.K3", question: "Runway markings are what color?", options: ["White", "Yellow", "Red"], answer: "White", explanation: "Runway markings are white. Taxiway markings are yellow.", img: null },
        { id: 62, category: "Airport Ops", acs: "UA.V.B.K3", question: "Taxiway markings are what color?", options: ["Yellow", "White", "Blue"], answer: "Yellow", explanation: "Taxiways are marked with yellow centerlines.", img: null },
        { id: 63, category: "Airport Ops", acs: "UA.V.B.K3", question: "A 'Chevrons' marking on a runway threshold indicates:", options: ["Area unfit for landing/takeoff/taxi", "Displaced Threshold", "Blast Pad"], answer: "Area unfit for landing/takeoff/taxi", explanation: "Chevrons (yellow arrows) indicate a blast pad or stopway that cannot be used for taxi, takeoff, or landing.", img: null },
        { id: 64, category: "Airport Ops", acs: "UA.V.B.K3", question: "A white arrow pointing down the runway center line before the number indicates:", options: ["Displaced Threshold (Taxi/Takeoff allowed)", "Closed Runway", "Short Runway"], answer: "Displaced Threshold (Taxi/Takeoff allowed)", explanation: "Arrows indicate a displaced threshold. You can taxi/takeoff there, but not land.", img: null },
        { id: 65, category: "Airport Ops", acs: "UA.V.B.K3", question: "A large 'X' on a runway means:", options: ["Runway Closed", "Helicopter pad", "Experimental"], answer: "Runway Closed", explanation: "A yellow X means the runway is closed to all operations.", img: null },
        { id: 66, category: "Airport Ops", acs: "UA.V.A.K3", question: "What indicates a civilian land airport beacon?", options: ["Green and White flashes", "White and Yellow", "Green and two Whites"], answer: "Green and White flashes", explanation: "Civilian land airports flash White and Green.", img: null },
        { id: 67, category: "Airport Ops", acs: "UA.V.A.K3", question: "What indicates a Military airport beacon?", options: ["Two White flashes, One Green", "White and Green", "Yellow and White"], answer: "Two White flashes, One Green", explanation: "Dual-peaked (two quick) white flashes between green flashes indicate a military airport.", img: null },
        { id: 68, category: "Airport Ops", acs: "UA.V.B.K3", question: "The phrase 'Line Up and Wait' means:", options: ["Taxi onto runway and wait", "Wait at the hold short line", "Takeoff immediately"], answer: "Taxi onto runway and wait", explanation: "ATC instruction to enter the runway and wait for clearance. Do not takeoff.", img: null },
        { id: 69, category: "Airport Ops", acs: "UA.V.B.K1", question: "UNICOM is typically used for:", options: ["Non-flight services (fuel, car rental)", "ATC control", "Weather only"], answer: "Non-flight services (fuel, car rental)", explanation: "UNICOM is a base station that provides info on services, wind, etc., at non-towered airports.", img: null },
        { id: 70, category: "Airport Ops", acs: "UA.V.B.K1", question: "ATIS (Automatic Terminal Information Service) provides:", options: ["Recorded weather and airport data", "Traffic control", "Emergency services"], answer: "Recorded weather and airport data", explanation: "ATIS is a continuous loop recording of local weather and airport conditions.", img: null },
        { id: 71, category: "Airport Ops", acs: "UA.V.A.K3", question: "The traffic pattern altitude (TPA) is generally:", options: ["1000 ft AGL", "500 ft AGL", "1500 ft AGL"], answer: "1000 ft AGL", explanation: "Standard TPA is 1000 feet AGL unless otherwise noted.", img: null },
        { id: 72, category: "Airport Ops", acs: "UA.V.A.K3", question: "What is the 'Base' leg?", options: ["Perpendicular to runway, before final", "Parallel to runway", "Departure leg"], answer: "Perpendicular to runway, before final", explanation: "Base leg is the transition between Downwind and Final approach.", img: null },
        { id: 73, category: "Airport Ops", acs: "UA.V.A.K3", question: "A 'Segmented Circle' provides info on:", options: ["Traffic pattern direction", "Wind direction", "Runway location"], answer: "Traffic pattern direction", explanation: "Segmented circles show traffic pattern indicators (L-shape) to show left or right turns.", img: null },
        { id: 74, category: "Airport Ops", acs: "UA.V.A.K3", question: "If a pilot announces 'Left Downwind for Runway 36', they are:", options: ["East of the runway", "West of the runway", "North of the runway"], answer: "East of the runway", explanation: "Runway 36 faces North. Downwind is opposite (South). A LEFT pattern for 36 puts the pilot on the East side.", img: null },
        { id: 75, category: "Airport Ops", acs: "UA.II.A.K3", question: "What is a TFR (Temporary Flight Restriction)?", options: ["Short term restriction (VIP, Disaster)", "Permanent restriction", "Training area"], answer: "Short term restriction (VIP, Disaster)", explanation: "TFRs are temporary bans for things like President travel, wildfires, or Super Bowls.", img: null },

        // --- WEATHER ---
        { id: 76, category: "Weather", acs: "UA.III.B.K1", question: "What are the characteristics of a stable air mass?", options: ["Stratiform clouds, fog, smooth air", "Cumulus clouds, turbulence", "Showery precipitation"], answer: "Stratiform clouds, fog, smooth air", explanation: "Stable air resists vertical motion, leading to flat (stratiform) clouds and poor visibility but smooth air.", img: null },
        { id: 77, category: "Weather", acs: "UA.III.B.K1", question: "What are the characteristics of an unstable air mass?", options: ["Turbulence, good visibility, cumulus clouds", "Smooth air, poor visibility", "Steady rain"], answer: "Turbulence, good visibility, cumulus clouds", explanation: "Unstable air rises easily, creating vertical clouds (cumulus) and turbulence, but clears out haze (good visibility).", img: null },
        { id: 78, category: "Weather", acs: "UA.III.B.K1", question: "What is 'Density Altitude'?", options: ["Pressure altitude corrected for non-standard temperature", "Height above the ground", "Height above sea level"], answer: "Pressure altitude corrected for non-standard temperature", explanation: "Density altitude is how the aircraft 'feels' the air. High density altitude = poor performance.", img: null },
        { id: 79, category: "Weather", acs: "UA.III.B.K1", question: "High humidity will do what to aircraft performance?", options: ["Decrease performance", "Increase performance", "No effect"], answer: "Decrease performance", explanation: "Water vapor is lighter than dry air, making the air less dense. Less dense air = reduced lift/power.", img: null },
        { id: 80, category: "Weather", acs: "UA.III.A.K2", question: "In a METAR, 'OVC007' means:", options: ["Overcast skies at 700 feet", "Overcast skies at 7,000 feet", "Visibility 7 miles"], answer: "Overcast skies at 700 feet", explanation: "Altitudes in METARs are in hundreds of feet. 007 = 700 ft.", img: null },
        { id: 81, category: "Weather", acs: "UA.III.B.K1", question: "What is the standard sea level pressure?", options: ["29.92 inches Hg", "1013.2 mb", "Both A and B"], answer: "Both A and B", explanation: "Standard pressure is 29.92 Hg or 1013.2 hectopascals/millibars.", img: null },
        { id: 82, category: "Weather", acs: "UA.III.B.K1", question: "Thunderstorms reach their greatest intensity during which stage?", options: ["Mature stage", "Cumulus stage", "Dissipating stage"], answer: "Mature stage", explanation: "The mature stage is characterized by rain reaching the surface and violent turbulence.", img: null },
        { id: 83, category: "Weather", acs: "UA.III.B.K1", question: "Which type of fog forms when moist air moves over colder ground?", options: ["Advection fog", "Radiation fog", "Upslope fog"], answer: "Advection fog", explanation: "Advection fog requires wind to move moist air over a cold surface (common in coastal areas).", img: null },
        { id: 84, category: "Weather", acs: "UA.III.B.K1", question: "Which type of fog forms on clear, calm nights?", options: ["Radiation fog", "Advection fog", "Steam fog"], answer: "Radiation fog", explanation: "Radiation fog forms when the ground cools rapidly at night, cooling the air above it.", img: null },
        { id: 85, category: "Weather", acs: "UA.III.B.K1", question: "Wind shear can occur:", options: ["At all altitudes", "Only at high altitudes", "Only near the ground"], answer: "At all altitudes", explanation: "Wind shear (sudden change in wind speed/direction) can happen at any altitude.", img: null },
        { id: 86, category: "Weather", acs: "UA.III.A.K2", question: "METAR 'VRB04KT' means:", options: ["Wind variable at 4 knots", "Visibility 4 miles", "Vertical visibility 400"], answer: "Wind variable at 4 knots", explanation: "VRB means variable direction. 04KT means 4 knots speed.", img: null },
        { id: 87, category: "Weather", acs: "UA.III.A.K2", question: "In a TAF, 'FM' (From) indicates:", options: ["Rapid change in conditions", "Gradual change", "Temporary change"], answer: "Rapid change in conditions", explanation: "FM indicates a rapid/significant change occurring at that time.", img: null },
        { id: 88, category: "Weather", acs: "UA.III.A.K2", question: "In a TAF, 'BECMG' (Becoming) indicates:", options: ["Gradual change over time", "Rapid change", "Probability"], answer: "Gradual change over time", explanation: "BECMG indicates a gradual change over the specified period.", img: null },
        { id: 89, category: "Weather", acs: "UA.III.B.K1", question: "Low-level wind shear is most dangerous during:", options: ["Takeoff and Landing", "Cruise", "Hover"], answer: "Takeoff and Landing", explanation: "Sudden changes in lift near the ground can cause accidents.", img: null },
        { id: 90, category: "Weather", acs: "UA.III.B.K1", question: "Dew point is:", options: ["Temperature at which air becomes saturated", "Temperature of the rain", "Freezing point"], answer: "Temperature at which air becomes saturated", explanation: "When Temp and Dew Point are close (within 3¬∞C), expect fog or clouds.", img: null },
        { id: 91, category: "Weather", acs: "UA.III.B.K1", question: "Standard temperature at sea level is:", options: ["15¬∞C (59¬∞F)", "0¬∞C (32¬∞F)", "20¬∞C (68¬∞F)"], answer: "15¬∞C (59¬∞F)", explanation: "Standard Day: 15¬∞C and 29.92 Hg.", img: null },
        { id: 92, category: "Weather", acs: "UA.III.B.K1", question: "What is a Microburst?", options: ["Intense downdraft < 2.5 miles wide", "Small tornado", "Gust of wind"], answer: "Intense downdraft < 2.5 miles wide", explanation: "Microbursts cause severe downdrafts and wind shear, very dangerous.", img: null },
        { id: 93, category: "Weather", acs: "UA.III.B.K1", question: "Ceiling is defined as the lowest layer of:", options: ["Broken (BKN) or Overcast (OVC)", "Scattered (SCT)", "Few (FEW)"], answer: "Broken (BKN) or Overcast (OVC)", explanation: "A ceiling is the lowest layer of BKN or OVC clouds.", img: null },
        { id: 94, category: "Weather", acs: "UA.III.B.K1", question: "Nimbus clouds indicate:", options: ["Rain/Precipitation", "Stability", "High altitude"], answer: "Rain/Precipitation", explanation: "Nimbus means rain (e.g., Cumulonimbus).", img: null },
        { id: 95, category: "Weather", acs: "UA.III.B.K1", question: "Steam fog occurs when:", options: ["Cold, dry air moves over warm water", "Warm air moves over cold land", "Ground cools at night"], answer: "Cold, dry air moves over warm water", explanation: "Common in autumn over lakes (sea smoke).", img: null },
        { id: 96, category: "Weather", acs: "UA.III.A.K2", question: "METAR 'SKC' means:", options: ["Sky Clear", "Sky Cloudy", "Smoke"], answer: "Sky Clear", explanation: "SKC = Sky Clear (human observation). CLR = Clear (automated).", img: null },
        { id: 97, category: "Weather", acs: "UA.III.A.K2", question: "Does 'FEW' or 'SCT' constitute a ceiling?", options: ["No", "Yes", "Depends on height"], answer: "No", explanation: "Only BKN or OVC constitute a ceiling.", img: null },
        { id: 98, category: "Weather", acs: "UA.III.B.K1", question: "The most dangerous icing type is:", options: ["Clear Ice", "Rime Ice", "Mixed Ice"], answer: "Clear Ice", explanation: "Clear ice is heavy, hard to see, and disrupts airflow significantly.", img: null },
        { id: 99, category: "Weather", acs: "UA.III.B.K1", question: "What causes weather?", options: ["Uneven heating of the earth's surface", "Rotation of the earth", "Ocean currents"], answer: "Uneven heating of the earth's surface", explanation: "Solar heating differences drive circulation and weather patterns.", img: null },
        { id: 100, category: "Weather", acs: "UA.III.B.K1", question: "Sea Breeze blows from:", options: ["Sea to Land (during day)", "Land to Sea", "North to South"], answer: "Sea to Land (during day)", explanation: "Land heats faster than water, rising air over land pulls cool air from the sea.", img: null },

        // --- PERFORMANCE / LOADING ---
        { id: 101, category: "Performance", acs: "UA.IV.A.K1", question: "If the center of gravity (CG) is too far aft (back), the aircraft becomes:", options: ["Less stable and harder to recover from stall", "More stable", "Nose heavy"], answer: "Less stable and harder to recover from stall", explanation: "Aft CG makes the aircraft tail heavy, reducing stability and making stall recovery difficult.", img: null },
        { id: 102, category: "Performance", acs: "UA.IV.A.K2", question: "When loading a drone with a camera, you must ensure:", options: ["It does not adversely affect the Center of Gravity", "It is taped securely", "It faces forward"], answer: "It does not adversely affect the Center of Gravity", explanation: "You must ensure the load is secure and does not upset the weight and balance (CG).", img: null },
        { id: 103, category: "Performance", acs: "UA.IV.B.K1", question: "The four forces acting on an aircraft in flight are:", options: ["Lift, Weight, Thrust, Drag", "Lift, Gravity, Power, Friction", "Speed, Mass, Power, Drag"], answer: "Lift, Weight, Thrust, Drag", explanation: "These are the four aerodynamic forces.", img: null },
        { id: 104, category: "Performance", acs: "UA.V.F.K2", question: "What happens to the battery in cold weather?", options: ["Capacity is reduced", "Capacity increases", "No effect"], answer: "Capacity is reduced", explanation: "Chemical reactions slow down in cold, reducing battery discharge rate and total capacity.", img: null },
        { id: 105, category: "Performance", acs: "UA.IV.A.K1", question: "Load Factor increases during:", options: ["Turns / Maneuvers", "Straight and level flight", "Hovering"], answer: "Turns / Maneuvers", explanation: "Banking the aircraft increases the G-force (load factor) on the wings/rotors.", img: null },
        { id: 106, category: "Performance", acs: "UA.IV.A.K1", question: "In a 60-degree bank, the load factor is:", options: ["2 Gs", "1 G", "1.5 Gs"], answer: "2 Gs", explanation: "At 60 degrees of bank, the effective weight of the aircraft doubles (2 Gs).", img: null },
        { id: 107, category: "Performance", acs: "UA.I.B.K22", question: "Before every flight, the remote pilot must ensure the aircraft is:", options: ["In a condition for safe operation", "Registered", "Fully charged"], answer: "In a condition for safe operation", explanation: "This is the overarching requirement for preflight inspections.", img: null },
        { id: 108, category: "Performance", acs: "UA.V.F.K2", question: "Lithium batteries should be stored:", options: ["In a cool, dry place", "Fully charged", "In the drone"], answer: "In a cool, dry place", explanation: "Batteries should be stored at storage voltage in a cool, safe environment.", img: null },
        { id: 109, category: "Performance", acs: "UA.I.B.K20", question: "Who is responsible for the performance of the sUAS?", options: ["Remote Pilot in Command", "Visual Observer", "The Owner"], answer: "Remote Pilot in Command", explanation: "The Remote PIC is directly responsible for, and is the final authority as to the operation of that aircraft.", img: null },
        { id: 110, category: "Performance", acs: "UA.IV.B.K1", question: "Exceeding the critical angle of attack causes a:", options: ["Stall", "Spin", "Dive"], answer: "Stall", explanation: "A stall occurs when the wing exceeds its critical angle of attack and smooth airflow is disrupted.", img: null },
        { id: 111, category: "Performance", acs: "UA.IV.A.K1", question: "Forward CG (nose heavy) causes:", options: ["Higher stall speed, slower cruise", "Lower stall speed", "Instability"], answer: "Higher stall speed, slower cruise", explanation: "A nose-heavy aircraft is stable but flies slower and stalls at a higher speed due to increased drag/load.", img: null },
        { id: 112, category: "Performance", acs: "UA.IV.A.K1", question: "If you increase weight, what happens to performance?", options: ["Decreased maneuverability and shorter flight time", "Increased speed", "Better stability"], answer: "Decreased maneuverability and shorter flight time", explanation: "Heavier aircraft require more power (draining battery) and turn slower.", img: null },
        { id: 113, category: "Performance", acs: "UA.IV.B.K1", question: "To recover from a stall, you must:", options: ["Decrease Angle of Attack (nose down)", "Pull up", "Increase power only"], answer: "Decrease Angle of Attack (nose down)", explanation: "You must break the stall by lowering the nose to restore smooth airflow.", img: null },
        { id: 114, category: "Performance", acs: "UA.IV.B.K1", question: "During a turn, the vertical component of lift:", options: ["Decreases", "Increases", "Stays same"], answer: "Decreases", explanation: "Lift is divided into vertical and horizontal. You must add power/pitch to maintain altitude.", img: null },
        { id: 115, category: "Performance", acs: "UA.V.F.K2", question: "A damaged LiPo battery can cause:", options: ["In-flight fire", "Loss of link", "GPS failure"], answer: "In-flight fire", explanation: "Punctured or swollen LiPos can spontaneously combust.", img: null },

        // --- OPERATIONS / PHYSIOLOGY / ADM ---
        { id: 116, category: "Operations", acs: "UA.V.E.K1", question: "What is 'CRM'?", options: ["Crew Resource Management", "Certified Remote Manager", "Crew Radio Method"], answer: "Crew Resource Management", explanation: "CRM is the effective use of all resources (people, info, hardware) to ensure safety.", img: null },
        { id: 117, category: "Operations", acs: "UA.V.D.K3", question: "Hyperventilation is caused by:", options: ["Stress/Anxiety leading to insufficient CO2", "Lack of Oxygen", "Carbon Monoxide"], answer: "Stress/Anxiety leading to insufficient CO2", explanation: "Breathing too fast removes too much CO2. Treatment: Slow breathing or talk aloud.", img: null },
        { id: 118, category: "Operations", acs: "UA.V.D.K3", question: "Acute fatigue is:", options: ["Short term (tired after a long day)", "Long term burnout", "Disease related"], answer: "Short term (tired after a long day)", explanation: "Acute fatigue is remedied by a good night's sleep. Chronic fatigue requires medical help.", img: null },
        { id: 119, category: "Operations", acs: "UA.V.E.K2", question: "What is the 'IMSAFE' checklist?", options: ["Illness, Medication, Stress, Alcohol, Fatigue, Emotion", "Inspection, Maintenance...", "Instrument, Map..."], answer: "Illness, Medication, Stress, Alcohol, Fatigue, Emotion", explanation: "A self-assessment tool for pilot physical/mental readiness.", img: null },
        { id: 120, category: "Operations", acs: "UA.V.E.K5", question: "Which hazardous attitude is 'I can do it' (taking risks)?", options: ["Macho", "Invulnerability", "Impulsivity"], answer: "Macho", explanation: "Macho: 'I can do it' / Trying to impress. Antidote: Taking chances is foolish.", img: null },
        { id: 121, category: "Operations", acs: "UA.V.E.K5", question: "Which hazardous attitude is 'What's the use?'", options: ["Resignation", "Anti-authority", "Impulsivity"], answer: "Resignation", explanation: "Resignation: Feeling helpless. Antidote: I am not helpless, I can make a difference.", img: null },
        { id: 122, category: "Operations", acs: "UA.V.E.K5", question: "Which hazardous attitude is 'It won't happen to me'?", options: ["Invulnerability", "Macho", "Impulsivity"], answer: "Invulnerability", explanation: "Antidote: It could happen to me.", img: null },
        { id: 123, category: "Operations", acs: "UA.V.E.K5", question: "Which hazardous attitude is 'Do it quickly'?", options: ["Impulsivity", "Anti-authority", "Macho"], answer: "Impulsivity", explanation: "Antidote: Not so fast, think first.", img: null },
        { id: 124, category: "Operations", acs: "UA.V.E.K5", question: "Which hazardous attitude is 'Don't tell me what to do'?", options: ["Anti-authority", "Macho", "Resignation"], answer: "Anti-authority", explanation: "Antidote: Follow the rules. They are usually right.", img: null },
        { id: 125, category: "Operations", acs: "UA.I.B.K10", question: "Who can be a Visual Observer?", options: ["Anyone capable of maintaining VLOS", "Only a certified pilot", "Only the owner"], answer: "Anyone capable of maintaining VLOS", explanation: "There is no certificate for a VO, but they must be competent and briefed.", img: null },
        { id: 126, category: "Operations", acs: "UA.V.C.K1", question: "Scanning at night should use:", options: ["Off-center viewing", "Direct viewing", "Sunglasses"], answer: "Off-center viewing", explanation: "Use peripheral vision (rods) at night. Look 5-10 degrees off center.", img: null },
        { id: 127, category: "Operations", acs: "UA.V.C.K1", question: "Autokinesis is:", options: ["Stationary light appears to move when stared at", "False horizon", "Flicker vertigo"], answer: "Stationary light appears to move when stared at", explanation: "At night, a static light may seem to move if you stare at it. Don't stare.", img: null },
        { id: 128, category: "Operations", acs: "UA.V.E.K1", question: "The 'DECIDE' model is for:", options: ["Aeronautical Decision Making", "Weather checking", "Landing"], answer: "Aeronautical Decision Making", explanation: "Detect, Estimate, Choose, Identify, Do, Evaluate.", img: null },
        { id: 129, category: "Operations", acs: "UA.V.E.K2", question: "The 'PAVE' checklist covers:", options: ["Pilot, Aircraft, EnVironment, External Pressures", "Pilot, Altitude, Velocity, Energy", "People, Area, Visuals, Emergency"], answer: "Pilot, Aircraft, EnVironment, External Pressures", explanation: "Risk assessment tool for the flight.", img: null },
        { id: 130, category: "Operations", acs: "UA.V.F.K1", question: "If you lose GPS, you should:", options: ["Fly manually (ATTI mode)", "Press Return to Home", "Wait"], answer: "Fly manually (ATTI mode)", explanation: "If GPS fails, RTH may not work. You must be able to fly manually.", img: null },
        { id: 131, category: "Operations", acs: "UA.V.F.K1", question: "A 'Lost Link' procedure should be:", options: ["Pre-programmed (RTH)", "Panic", "Land immediately where it is"], answer: "Pre-programmed (RTH)", explanation: "The drone should automatically execute a safe procedure (like Return to Home) on link loss.", img: null },
        { id: 132, category: "Operations", acs: "UA.I.B.K6", question: "Can you drop objects from a drone?", options: ["Yes, if it creates no undue hazard", "No, never", "Only feathers"], answer: "Yes, if it creates no undue hazard", explanation: "Dropping objects is allowed if you ensure it doesn't hurt anyone or damage property.", img: null },
        { id: 133, category: "Operations", acs: "UA.I.A.K4", question: "When are you required to report an accident?", options: ["Serious injury or >$500 damage", "Any crash", "Only if drone is destroyed"], answer: "Serious injury or >$500 damage", explanation: "Report if: Serious injury (hospitalization) OR damage >$500 (excluding drone cost).", img: null },
        { id: 134, category: "Operations", acs: "UA.V.C.K1", question: "How long does it take for eyes to adapt to darkness?", options: ["30 minutes", "5 minutes", "1 hour"], answer: "30 minutes", explanation: "Dark adaptation takes about 30 minutes. Avoid bright lights.", img: null },
        { id: 135, category: "Operations", acs: "UA.V.E.K3", question: "What is 'Situational Awareness'?", options: ["Accurate perception of operational conditions", "Knowing where north is", "Listening to radio"], answer: "Accurate perception of operational conditions", explanation: "Knowing what is happening around you.", img: null },
        { id: 136, category: "Operations", acs: "UA.V.F.K1", question: "A 'Fly-away' is:", options: ["Uncontrolled flight", "A controlled landing", "A type of maneuver"], answer: "Uncontrolled flight", explanation: "When the drone stops responding and flies off (often interference or GPS error).", img: null },
        { id: 137, category: "Operations", acs: "UA.II.A.K3", question: "Which resource provides the most up-to-date info on TFRs?", options: ["FSS (Flight Service Station) / FAA website", "Last year's chart", "Google Maps"], answer: "FSS (Flight Service Station) / FAA website", explanation: "Always check official sources like 1800wxbrief or FAA drone zone/B4UFLY.", img: null },
        { id: 138, category: "Operations", acs: "UA.I.B.K11", question: "Can a remote pilot operate more than one drone at a time?", options: ["No", "Yes", "Up to 5"], answer: "No", explanation: "Part 107 prohibits operating multiple sUAS simultaneously (swarming) without a waiver.", img: null },
        { id: 139, category: "Operations", acs: "UA.I.B.K21", question: "The maximum height above a structure (within 400ft radius) is:", options: ["400 feet above the structure", "400 feet MSL", "500 feet AGL"], answer: "400 feet above the structure", explanation: "You can fly 400ft above the top of the tower.", img: null },
        { id: 140, category: "Operations", acs: "UA.V.D.K4", question: "Dehydration can cause:", options: ["Dizziness, headache, fatigue", "Better vision", "Hyperventilation"], answer: "Dizziness, headache, fatigue", explanation: "Drink water. Dehydration impairs judgement.", img: null },
        { id: 141, category: "Operations", acs: "UA.II.A.K2", question: "A 'VOR' is used for:", options: ["Radio Navigation (Manned)", "Drone control", "Weather"], answer: "Radio Navigation (Manned)", explanation: "VOR stations are for manned aircraft nav. You see them on charts (Compass rose).", img: null },
        { id: 142, category: "Operations", acs: "UA.II.A.K3", question: "IR (Instrument Routes) MTRs are flown:", options: ["Regardless of weather (IFR)", "Only in good weather", "Only at night"], answer: "Regardless of weather (IFR)", explanation: "IR = Instrument Route. VR = Visual Route.", img: null },
        { id: 143, category: "Operations", acs: "UA.V.D.K3", question: "How do you avoid 'flicker vertigo'?", options: ["Don't look through propeller blades at light", "Close eyes", "Wear green glasses"], answer: "Don't look through propeller blades at light", explanation: "Flashing lights (4-20Hz) can cause nausea or seizures.", img: null },
        { id: 144, category: "Operations", acs: "UA.I.B.K1", question: "Who can grant a Waiver?", options: ["The FAA", "ATC", "Police"], answer: "The FAA", explanation: "Waivers (e.g., for BVLOS) are issued by the FAA, not local ATC.", img: null },
        { id: 145, category: "Operations", acs: "UA.II.B.K2", question: "A 'NOTAM' is a:", options: ["Notice to Air Missions", "Notice to Air Men", "Note of Time and Mass"], answer: "Notice to Air Missions", explanation: "Provides time-critical info (closed runways, tower lights out, etc.).", img: null },
        
        // --- EXTRA PRACTICE MIX ---
        { id: 146, category: "Mix", acs: "UA.II.A.K2", question: "Chart Supplement provides:", options: ["Detailed airport info", "Weather forecast", "Rules"], answer: "Detailed airport info", explanation: "It lists hours, frequencies, runways, and remarks for airports.", img: null },
        { id: 147, category: "Mix", acs: "UA.V.B.K1", question: "Frequency 122.9 is often:", options: ["MULTICOM", "Emergency", "Military"], answer: "MULTICOM", explanation: "Used at airports with no Tower and no specific CTAF listed.", img: null },
        { id: 148, category: "Mix", acs: "UA.II.A.K2", question: "Latitude lines run:", options: ["Parallel to Equator (East/West)", "Pole to Pole", "Vertical"], answer: "Parallel to Equator (East/West)", explanation: "Latitude = Ladder (Steps go up/down). Measures North/South distance.", img: null },
        { id: 149, category: "Mix", acs: "UA.II.A.K2", question: "Longitude lines run:", options: ["Pole to Pole (North/South)", "Parallel to Equator", "Horizontal"], answer: "Pole to Pole (North/South)", explanation: "Longitude (Long way). Measures East/West distance.", img: null },
        { id: 150, category: "Mix", acs: "UA.II.A.K2", question: "Each tick mark on a Lat/Long line represents:", options: ["1 Minute", "1 Degree", "10 Seconds"], answer: "1 Minute", explanation: "There are 60 minutes in a degree. Ticks often mark minutes.", img: null },
        { id: 151, category: "Mix", acs: "UA.II.A.K2", question: "A Blue airport symbol means:", options: ["Control Tower (Controlled)", "No Tower", "Private"], answer: "Control Tower (Controlled)", explanation: "Blue = Control Tower. Magenta = Non-towered.", img: null },
        { id: 152, category: "Mix", acs: "UA.II.A.K2", question: "A Magenta airport symbol means:", options: ["No Control Tower", "Controlled", "Military"], answer: "No Control Tower", explanation: "Magenta = Non-towered (uncontrolled) airport.", img: null },
        { id: 153, category: "Mix", acs: "UA.II.A.K2", question: "VFR cruising altitudes (manned) start at:", options: ["3,000 ft AGL", "1,000 ft AGL", "18,000 ft"], answer: "3,000 ft AGL", explanation: "Hemispheric rule (East is Odd, West is Even) starts > 3000 AGL.", img: null },
        { id: 154, category: "Mix", acs: "UA.I.B.K21", question: "Guy wires on towers:", options: ["Extend outward and are hard to see", "Are always lighted", "Are painted red"], answer: "Extend outward and are hard to see", explanation: "Stay 2000ft horizontally from towers to avoid invisible guy wires.", img: null },
        { id: 155, category: "Mix", acs: "UA.V.D.K1", question: "Over-the-counter (OTC) meds:", options: ["Can affect judgement", "Are always safe", "Improve flying"], answer: "Can affect judgement", explanation: "Antihistamines/decongestants can cause drowsiness. Check 'Do not operate machinery'.", img: null },
        { id: 156, category: "Mix", acs: "UA.I.B.K2", question: "A remote pilot must have their certificate:", options: ["Physical card accessible during flight", "At home", "Digital copy only"], answer: "Physical card accessible during flight", explanation: "You must have your certificate physically available to show FAA/Law enforcement.", img: null },
        { id: 157, category: "Mix", acs: "UA.I.B.K1", question: "Can you fly BVLOS (Beyond Visual Line of Sight)?", options: ["Only with a Waiver", "Yes, with FPV goggles", "Never"], answer: "Only with a Waiver", explanation: "BVLOS requires a specific waiver. FPV requires a VO.", img: null },
        { id: 158, category: "Mix", acs: "UA.I.B.K2", question: "Registration markings must be:", options: ["On the outside, durable, legible", "Inside battery compartment", "Temporary"], answer: "On the outside, durable, legible", explanation: "Must be visible without tools (though inside battery hatch used to be allowed, rule changed).", img: null },
        { id: 159, category: "Mix", acs: "UA.I.A.K1", question: "Registration is valid for:", options: ["3 years", "1 year", "Lifetime"], answer: "3 years", explanation: "Re-register every 3 years.", img: null },
        { id: 160, category: "Mix", acs: "UA.I.A.K1", question: "If you sell your drone:", options: ["Remove your registration number", "Keep it on", "Transfer it"], answer: "Remove your registration number", explanation: "Registration belongs to the pilot (for hobby/Part 107 general) or aircraft. Usually, remove it.", img: null },
        { id: 161, category: "Mix", acs: "UA.I.A.K1", question: "Can a 15-year-old take the test?", options: ["No, must be 16", "Yes, but can't get cert", "Yes"], answer: "No, must be 16", explanation: "Minimum age to test is 16.", img: null },
        { id: 162, category: "Mix", acs: "UA.I.B.K15", question: "Taking a photo of a private property:", options: ["Is generally legal from public airspace", "Is trespassing", "Is illegal"], answer: "Is generally legal from public airspace", explanation: "Airspace is public, but privacy laws vary. Generally legal, but be respectful.", img: null },
        { id: 163, category: "Mix", acs: "UA.I.B.K10", question: "Does a VO need a Part 107 license?", options: ["No", "Yes", "Only for night ops"], answer: "No", explanation: "Visual Observers do not need a license.", img: null },
        { id: 164, category: "Mix", acs: "UA.III.B.K1", question: "If humidity is 100%, expect:", options: ["Fog/Clouds", "Clear sky", "Wind"], answer: "Fog/Clouds", explanation: "100% humidity means air is saturated.", img: null },
        { id: 165, category: "Mix", acs: "UA.III.B.K1", question: "Standard Lapse Rate (temperature) is:", options: ["-2¬∞C per 1000 ft", "-5¬∞C per 1000 ft", "No change"], answer: "-2¬∞C per 1000 ft", explanation: "Air gets colder as you go up (approx 2 degrees C per 1000ft).", img: null },
        { id: 166, category: "Mix", acs: "UA.III.B.K1", question: "Coriolis force causes wind to:", options: ["Deflect to the right in Northern Hemisphere", "Deflect left", "Stop"], answer: "Deflect to the right in Northern Hemisphere", explanation: "Earth's rotation affects wind direction.", img: null },
        { id: 167, category: "Mix", acs: "UA.V.F.K1", question: "When flying over water, be aware of:", options: ["Depth perception issues / glare", "Sharks", "Wind shear"], answer: "Depth perception issues / glare", explanation: "Water makes judging altitude difficult.", img: null },
        { id: 168, category: "Mix", acs: "UA.V.C.K1", question: "Birds usually:", options: ["Dive when threatened", "Climb", "Fly straight"], answer: "Dive when threatened", explanation: "You should climb to avoid birds, as they tend to dive.", img: null },
        { id: 169, category: "Mix", acs: "UA.I.A.K1", question: "A 'Part 107' license is officially called:", options: ["Remote Pilot Certificate with sUAS rating", "Drone License", "UAV Permit"], answer: "Remote Pilot Certificate with sUAS rating", explanation: "That is the official title.", img: null },
        { id: 170, category: "Mix", acs: "UA.V.D.K1", question: "If you have a physical condition that impairs safety:", options: ["Do not fly", "Fly cautiously", "Ask a friend"], answer: "Do not fly", explanation: "Self-grounding is required.", img: null },
        { id: 171, category: "Mix", acs: "UA.II.A.K1", question: "Class A airspace starts at:", options: ["18,000 ft MSL", "10,000 ft MSL", "Surface"], answer: "18,000 ft MSL", explanation: "Class A is high altitude (18k to 60k), usually IFR only. Drones not allowed.", img: null },
        { id: 172, category: "Mix", acs: "UA.II.A.K1", question: "The floor of Class B is typically:", options: ["Surface (at center)", "1000 ft", "2000 ft"], answer: "Surface (at center)", explanation: "Class B usually goes Surface to 10,000ft.", img: null },
        { id: 173, category: "Mix", acs: "UA.I.B.K23", question: "Is a transponder required in Class D?", options: ["No", "Yes", "Sometimes"], answer: "No", explanation: "Transponder not typically required in Class D (unlike B and C).", img: null },
        { id: 174, category: "Mix", acs: "UA.I.C.K2", question: "Flying under the influence of drugs/alcohol is:", options: ["Prohibited", "Allowed if <0.04%", "Allowed in emergencies"], answer: "Prohibited", explanation: "Strictly prohibited.", img: null },
        { id: 175, category: "Mix", acs: "UA.I.A.K1", question: "How long is a temporary certificate valid?", options: ["120 days", "30 days", "60 days"], answer: "120 days", explanation: "The paper temporary cert is good for 120 days.", img: null },
        { id: 176, category: "Mix", acs: "UA.I.B.K9", question: "Can you fly at night without lights?", options: ["No", "Yes", "Only in rural areas"], answer: "No", explanation: "Anti-collision lights are mandatory for night ops.", img: null },
        { id: 177, category: "Mix", acs: "UA.I.B.K9", question: "Civil Twilight is:", options: ["30 mins before sunrise / 30 mins after sunset", "1 hour after sunset", "Pitch black"], answer: "30 mins before sunrise / 30 mins after sunset", explanation: "You can fly during civil twilight with lights.", img: null },
        { id: 178, category: "Mix", acs: "UA.III.A.K2", question: "A TAF is valid for:", options: ["24 or 30 hours", "6 hours", "1 hour"], answer: "24 or 30 hours", explanation: "Terminal Aerodrome Forecast covers a longer period than METAR.", img: null },
        { id: 179, category: "Mix", acs: "UA.I.B.K20", question: "Lending your drone to a friend:", options: ["You are responsible if you are PIC", "They are responsible", "No one is"], answer: "You are responsible if you are PIC", explanation: "If you act as PIC, you are responsible.", img: null },
        { id: 180, category: "Mix", acs: "UA.I.B.K11", question: "Operating multiple drones (Swarm):", options: ["Requires waiver", "Allowed", "Allowed if < 0.55lbs"], answer: "Requires waiver", explanation: "One pilot, one drone (unless waiver).", img: null },
        { id: 181, category: "Mix", acs: "UA.II.A.K1", question: "A dashed magenta line indicates Class E starting at:", options: ["Surface", "700 ft", "1200 ft"], answer: "Surface", explanation: "Dashed magenta = Class E surface area.", img: null },
        { id: 182, category: "Mix", acs: "UA.II.A.K1", question: "Shaded Magenta indicates Class E starting at:", options: ["700 ft AGL", "1200 ft AGL", "Surface"], answer: "700 ft AGL", explanation: "Shaded Magenta = 700ft floor.", img: null },
        { id: 183, category: "Mix", acs: "UA.II.A.K1", question: "Shaded Blue indicates Class E starting at:", options: ["1200 ft AGL", "700 ft AGL", "Surface"], answer: "1200 ft AGL", explanation: "Shaded Blue = 1200ft floor.", img: null },
        { id: 184, category: "Mix", acs: "UA.II.A.K2", question: "Zipper line on a chart indicates:", options: ["Alert area", "Altitude change", "Floor of Class E change"], answer: "Altitude change", explanation: "Often marks where floor of Class E changes (e.g., 700 to 1200).", img: null },
        { id: 185, category: "Mix", acs: "UA.II.A.K2", question: "Blue numbers on chart (e.g., 45):", options: ["Maximum Elevation Figure (MEF)", "Speed limit", "Radio freq"], answer: "Maximum Elevation Figure (MEF)", explanation: "Large blue numbers indicate height of highest obstacle in that quadrangle (in hundreds of feet).", img: null },
        { id: 186, category: "Mix", acs: "UA.V.C.K1", question: "Proper scanning technique:", options: ["Left to right, 10 degree sectors", "Up and down", "Stare at center"], answer: "Left to right, 10 degree sectors", explanation: "Systematic scanning.", img: null },
        { id: 187, category: "Mix", acs: "UA.I.B.K22", question: "Before flight, check:", options: ["Notams, Weather, Aircraft", "Email", "News"], answer: "Notams, Weather, Aircraft", explanation: "Preflight action.", img: null },
        { id: 188, category: "Mix", acs: "UA.III.A.K3", question: "A 'SIGMET' advises of:", options: ["Severe weather (all aircraft)", "Light rain", "Traffic"], answer: "Severe weather (all aircraft)", explanation: "Significant Meteorological Information (icing, turbulence, ash).", img: null },
        { id: 189, category: "Mix", acs: "UA.III.A.K3", question: "A 'AIRMET' advises of:", options: ["Weather hazardous to small aircraft", "Severe weather", "Clear skies"], answer: "Weather hazardous to small aircraft", explanation: "Airman's Meteorological Information (less severe than Sigmet).", img: null },
        { id: 190, category: "Mix", acs: "UA.III.B.K1", question: "Convective Sigmet implies:", options: ["Thunderstorms/Tornadoes", "Fog", "Wind"], answer: "Thunderstorms/Tornadoes", explanation: "Severe convective activity.", img: null },
        { id: 191, category: "Mix", acs: "UA.III.B.K1", question: "Squall line is:", options: ["Band of thunderstorms", "Line of birds", "Fog bank"], answer: "Band of thunderstorms", explanation: "Narrow band of active thunderstorms.", img: null },
        { id: 192, category: "Mix", acs: "UA.I.B.K8", question: "Which is true about alcohol?", options: ["It affects judgement before physical ability", "Physical goes first", "No effect"], answer: "It affects judgement before physical ability", explanation: "Cognitive functions decline first.", img: null },
        { id: 193, category: "Mix", acs: "UA.V.F.K2", question: "Most sUAS batteries are:", options: ["LiPo (Lithium Polymer)", "NiCad", "Lead Acid"], answer: "LiPo (Lithium Polymer)", explanation: "High energy density.", img: null },
        { id: 194, category: "Mix", acs: "UA.V.F.K1", question: "GPS satellites needed for 3D position:", options: ["4", "3", "2"], answer: "4", explanation: "4 satellites required for Lat, Long, and Altitude.", img: null },
        { id: 195, category: "Mix", acs: "UA.V.F.K1", question: "Loss of GPS leads to:", options: ["Drift (ATTI mode)", "Crash", "RTH"], answer: "Drift (ATTI mode)", explanation: "Drone will drift with wind.", img: null },
        { id: 196, category: "Mix", acs: "UA.V.F.K1", question: "Interference can be caused by:", options: ["Metal, Wifi, Magnetic fields", "Clouds", "Birds"], answer: "Metal, Wifi, Magnetic fields", explanation: "Reinforced concrete, towers, power lines.", img: null },
        { id: 197, category: "Mix", acs: "UA.V.F.K1", question: "Return to Home altitude should be set:", options: ["Higher than obstacles", "Lowest possible", "100 ft"], answer: "Higher than obstacles", explanation: "Ensure RTH height clears trees/buildings.", img: null },
        { id: 198, category: "Mix", acs: "UA.V.F.K1", question: "Fail-safe refers to:", options: ["Auto-procedure on error (Link loss)", "Parachute", "Bumper"], answer: "Auto-procedure on error (Link loss)", explanation: "System behavior when things go wrong.", img: null },
        { id: 199, category: "Mix", acs: "UA.I.A.K4", question: "First person to call in an emergency:", options: ["911 / ATC if required", "Mom", "FAA"], answer: "911 / ATC if required", explanation: "Prioritize safety.", img: null },
        { id: 200, category: "Mix", acs: "UA.I.A.K1", question: "The Part 107 test has how many questions?", options: ["60", "100", "50"], answer: "60", explanation: "The actual exam is 60 multiple choice questions.", img: null },
        { id: 201, category: "Mix", acs: "UA.I.A.K1", question: "Passing score for Part 107 is:", options: ["70%", "80%", "100%"], answer: "70%", explanation: "You must get 70% to pass.", img: null },
        { id: 202, category: "Mix", acs: "UA.I.B.K8", question: "Maximum blood alcohol:", options: ["0.04%", "0.08%", "0.02%"], answer: "0.04%", explanation: "Stricter than driving.", img: null },
        { id: 203, category: "Mix", acs: "UA.I.B.K8", question: "Time to wait after alcohol:", options: ["8 hours", "4 hours", "24 hours"], answer: "8 hours", explanation: "Bottle to Throttle.", img: null },
        { id: 204, category: "Mix", acs: "UA.I.B.K9", question: "Anti-collision lights must be visible for:", options: ["3 Statute Miles", "1 Mile", "5 Miles"], answer: "3 Statute Miles", explanation: "For night/twilight ops.", img: null },
        { id: 205, category: "Mix", acs: "UA.V.B.K3", question: "Stationary front symbol:", options: ["Alternating red circles and blue triangles", "Blue triangles", "Red circles"], answer: "Alternating red circles and blue triangles", explanation: "Opposing sides.", img: null }
    ];

    // --- STATE MANAGEMENT ---
    let currentDeck = [];
    let currentIndex = 0;
    let isFlipped = false;
    let isQuizMode = false;
    let isReviewMode = false;
    let reviewList = [];
    let masteredList = [];
    let starredList = []; // NEW: Array of IDs for starred cards
    
    // User Settings
    let studentName = "";
    let studentClass = "";
    let teacherEmail = "rsteward@responsiveedtx.com";

    // --- INITIALIZATION ---
    window.onload = function() {
        loadProgress();
        loadLoginSettings(); 
        
        populateSubjects();
        applyFilters(); 
        updateStats();
        
        // Show Login Modal
        document.getElementById('loginModal').style.display = 'flex';
    };

    function shuffleDeck(data) {
        // Just returns shuffled copy, does NOT set global currentDeck
        let deck = JSON.parse(JSON.stringify(data));
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
        return deck;
    }

    // --- RENDER LOGIC ---

    function renderCard() {
        if (currentDeck.length === 0) {
            alert("No cards available in this filter!");
            resetFilter();
            return;
        }

        const card = currentDeck[currentIndex];
        
        // --- Flashcard Mode Elements ---
        document.getElementById('fcCategory').textContent = card.category;
        document.getElementById('fcCategoryBack').textContent = card.category;
        document.getElementById('fcQuestion').textContent = card.question;
        document.getElementById('fcAnswer').textContent = card.answer;
        document.getElementById('fcExplanation').textContent = card.explanation;
        
        // ACS Code
        const acsText = card.acs ? `ACS: ${card.acs}` : "ACS: ---";
        document.getElementById('fcAcs').textContent = acsText;
        document.getElementById('fcAcsBack').textContent = acsText;
        document.getElementById('qzAcs').textContent = acsText;

        // Image Handling
        const fcImgContainer = document.getElementById('fcImgContainer');
        const fcImg = document.getElementById('fcImg');
        
        if (card.img) {
            fcImg.src = card.img;
            fcImgContainer.style.display = 'block';
        } else {
            fcImgContainer.style.display = 'none';
        }

        // Reset Flip State
        const cardEl = document.getElementById('flashcard');
        cardEl.classList.remove('is-flipped');
        document.getElementById('fcActions').style.visibility = 'hidden';
        isFlipped = false;

        // Update Star UI
        updateStarUI(card.id);

        // --- Quiz Mode Elements ---
        document.getElementById('qzCategory').textContent = card.category;
        document.getElementById('qzQuestion').textContent = card.question;
        document.getElementById('qzFeedback').style.display = 'none';
        
        const qzImgContainer = document.getElementById('qzImgContainer');
        const qzImg = document.getElementById('qzImg');

        if (card.img) {
            qzImg.src = card.img;
            qzImgContainer.style.display = 'block';
        } else {
            qzImgContainer.style.display = 'none';
        }
        
        // Generate Options
        const optsContainer = document.getElementById('qzOptions');
        optsContainer.innerHTML = '';
        let displayOptions = [...card.options];
        displayOptions.sort(() => Math.random() - 0.5);

        displayOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'quiz-btn';
            btn.textContent = opt;
            btn.onclick = () => handleQuizAnswer(btn, opt, card);
            optsContainer.appendChild(btn);
        });

        // Prev Button State
        document.getElementById('prevBtn').disabled = (currentIndex === 0);

        updateProgress();
    }

    function toggleStar(e) {
        e.stopPropagation(); // Don't flip card
        const card = currentDeck[currentIndex];
        const index = starredList.indexOf(card.id);
        
        if (index === -1) {
            starredList.push(card.id);
        } else {
            starredList.splice(index, 1);
        }
        
        updateStarUI(card.id);
        saveProgress();
    }

    function updateStarUI(cardId) {
        const isStarred = starredList.includes(cardId);
        const starText = isStarred ? "‚òÖ" : "‚òÜ";
        const color = isStarred ? "var(--star-color)" : "#d1d5db";
        
        const btns = [
            document.getElementById('fcStarBtn'),
            document.getElementById('fcStarBtnBack'),
            document.getElementById('qzStarBtn')
        ];

        btns.forEach(btn => {
            if(btn) {
                btn.textContent = starText;
                btn.style.color = color;
                if(isStarred) btn.classList.add('starred');
                else btn.classList.remove('starred');
            }
        });
    }

    function flipCard(event) {
        if (event.target.classList.contains('card-image') || event.target.classList.contains('star-btn')) return;

        if (isQuizMode) return;
        const cardEl = document.getElementById('flashcard');
        
        if (isFlipped) {
            cardEl.classList.remove('is-flipped');
            document.getElementById('fcActions').style.visibility = 'hidden';
            isFlipped = false;
        } else {
            cardEl.classList.add('is-flipped');
            document.getElementById('fcActions').style.visibility = 'visible';
            isFlipped = true;
        }
    }

    function recordResult(correct) {
        const card = currentDeck[currentIndex];
        if (correct) {
            if (!masteredList.includes(card.id)) masteredList.push(card.id);
            reviewList = reviewList.filter(id => id !== card.id);
        } else {
            if (!reviewList.includes(card.id)) reviewList.push(card.id);
            masteredList = masteredList.filter(id => id !== card.id);
        }
        saveProgress();
        updateStats();
    }

    function handleQuizAnswer(btn, selected, card) {
        const allBtns = document.querySelectorAll('.quiz-btn');
        allBtns.forEach(b => b.disabled = true);
        const isCorrect = selected === card.answer;
        
        if (isCorrect) {
            btn.classList.add('correct');
            recordResult(true);
            document.getElementById('qzFeedbackText').textContent = "Correct! ‚úÖ";
            document.getElementById('qzFeedbackText').style.color = "var(--success)";
        } else {
            btn.classList.add('incorrect');
            allBtns.forEach(b => {
                if (b.textContent === card.answer) b.classList.add('correct');
            });
            recordResult(false);
            document.getElementById('qzFeedbackText').textContent = "Incorrect ‚ùå";
            document.getElementById('qzFeedbackText').style.color = "var(--danger)";
        }
        document.getElementById('qzExplanation').textContent = card.explanation;
        document.getElementById('qzFeedback').style.display = 'block';
    }

    function nextCard() {
        currentIndex++;
        if (currentIndex >= currentDeck.length) {
            if (confirm("You've finished this deck! Start over?")) {
                currentDeck = shuffleDeck(currentDeck);
                currentIndex = 0;
            } else {
                currentIndex = 0;
            }
        }
        renderCard();
    }

    function prevCard() {
        if (currentIndex > 0) {
            currentIndex--;
            renderCard();
        }
    }

    // --- MODES & UTILITIES ---
    function toggleMode() {
        isQuizMode = !isQuizMode;
        const btn = document.getElementById('modeToggleBtn');
        const fcDiv = document.getElementById('flashcardMode');
        const qzDiv = document.getElementById('quizMode');

        if (isQuizMode) {
            btn.textContent = "Switch to Flashcards";
            fcDiv.classList.add('hidden');
            qzDiv.classList.remove('hidden');
        } else {
            btn.textContent = "Switch to Quiz Mode";
            fcDiv.classList.remove('hidden');
            qzDiv.classList.add('hidden');
        }
        renderCard();
    }

    function toggleReview() {
        if (isReviewMode) {
            isReviewMode = false;
            applyFilters(); 
        } else {
            if (reviewList.length === 0) {
                alert("No cards marked for review.");
                return;
            }
            isReviewMode = true;
            document.getElementById('reviewBtn').textContent = "Return to Deck";
            const reviewDeck = questionData.filter(q => reviewList.includes(q.id));
            currentDeck = shuffleDeck(reviewDeck);
            
            currentIndex = 0;
            renderCard();
            updateStats();
        }
    }

    function resetFilter() {
        applyFilters(); 
    }

    function populateSubjects() {
        const categories = [...new Set(questionData.map(q => q.category))].sort();
        const select = document.getElementById('subjectSelect');
        categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            select.appendChild(option);
        });
    }

    function applyFilters() {
        const category = document.getElementById('subjectSelect').value;
        const countVal = document.getElementById('countSelect').value;
        
        if (isReviewMode) {
            isReviewMode = false;
        }

        let filtered;
        
        // 1. Filter by Category / Starred
        if (category === "ALL") {
            filtered = questionData;
        } else if (category === "STARRED") {
            filtered = questionData.filter(q => starredList.includes(q.id));
            if (filtered.length === 0) {
                alert("You haven't starred any questions yet!");
                document.getElementById('subjectSelect').value = "ALL";
                filtered = questionData; // fallback
            }
        } else {
            filtered = questionData.filter(q => q.category === category);
        }
            
        // 2. Shuffle
        let shuffled = shuffleDeck(filtered);

        // 3. Limit by Count
        if (countVal !== "ALL") {
            const limit = parseInt(countVal);
            if (shuffled.length > limit) {
                shuffled = shuffled.slice(0, limit);
            }
        }

        // 4. Set Deck
        currentDeck = shuffled;
        currentIndex = 0;
        isFlipped = false;
        
        renderCard();
        updateStats();
    }

    // --- LOGIN / SETUP LOGIC ---
    function loadLoginSettings() {
        try {
            const savedEmail = localStorage.getItem('faa_teacherEmail');
            if (savedEmail) {
                teacherEmail = savedEmail;
                document.getElementById('inputEmail').value = teacherEmail;
            }
        } catch(e) {}
    }

    function startSession() {
        const sName = document.getElementById('inputName').value.trim();
        const sClass = document.getElementById('inputClass').value.trim();
        const tEmail = document.getElementById('inputEmail').value.trim();

        if (!sName) {
            alert("Please enter your name to continue.");
            return;
        }

        studentName = sName;
        studentClass = sClass;
        teacherEmail = tEmail || "rsteward@responsiveedtx.com";

        try {
            localStorage.setItem('faa_teacherEmail', teacherEmail);
        } catch(e) {}

        document.getElementById('loginModal').style.display = 'none';
    }

    // --- REPORT GENERATION ---
    function generateReport() {
        let stats = {};
        let totalStudied = 0;
        let totalNeedsReview = 0;
        let totalMastered = 0;
        
        questionData.forEach(q => {
            if (!stats[q.category]) {
                stats[q.category] = { total: 0, mastered: 0, review: 0 };
            }
        });

        masteredList.forEach(id => {
            const q = questionData.find(i => i.id === id);
            if (q) {
                stats[q.category].mastered++;
                stats[q.category].total++;
                totalStudied++;
                totalMastered++;
            }
        });

        reviewList.forEach(id => {
            const q = questionData.find(i => i.id === id);
            if (q) {
                stats[q.category].review++;
                stats[q.category].total++;
                totalStudied++;
                totalNeedsReview++;
            }
        });

        const now = new Date().toLocaleString();
        let body = `FAA Part 107 Study Report\nDate: ${now}\n`;
        body += `Student Name: ${studentName || "____________________"}\n`;
        body += `Class: ${studentClass || "____________________"}\n\n`;
        
        body += `--- OVERALL PROGRESS ---\n`;
        body += `Total Cards Studied: ${totalStudied}\n`;
        body += `Proficient: ${totalMastered}\n`;
        body += `Needs Review (Wrong/Flagged): ${totalNeedsReview}\n`;
        if (totalStudied > 0) {
            body += `Proficiency Rate: ${Math.round((totalMastered/totalStudied)*100)}%\n\n`;
        } else {
            body += `\n`;
        }

        body += `--- SUBJECT BREAKDOWN ---\n`;
        let hasData = false;
        for (const [cat, data] of Object.entries(stats)) {
            if (data.total > 0) {
                hasData = true;
                const score = Math.round((data.mastered / data.total) * 100);
                body += `${cat}: ${score}% Proficient (${data.mastered}/${data.total})\n`;
                if (data.review > 0) {
                    body += `   - Needs Review: ${data.review} questions\n`;
                }
            }
        }
        if (!hasData) body += "No study data recorded yet.\n";

        body += `\n--- DETAILED 'NEEDS REVIEW' LIST ---\n`;
        if (reviewList.length === 0) {
            body += "Great job! No questions marked for review.\n";
        } else {
            reviewList.forEach(id => {
                const q = questionData.find(i => i.id === id);
                if (q) {
                    let qText = q.question.length > 60 ? q.question.substring(0, 60) + "..." : q.question;
                    body += `[${q.category}] [${q.acs || "NO-ACS"}] ${qText}\n`;
                }
            });
        }

        document.getElementById('reportText').value = body;
        document.getElementById('reportEmailDisplay').textContent = teacherEmail;
        document.getElementById('reportTitle').textContent = "Study Session Report";
        document.getElementById('reportModal').style.display = 'block';

        const subject = encodeURIComponent(`Part 107 Study Report - ${studentName}`);
        const bodyEncoded = encodeURIComponent(body);
        
        try {
            window.location.href = `mailto:${teacherEmail}?subject=${subject}&body=${bodyEncoded}`;
        } catch (e) {
            console.log("Mailto failed or blocked");
        }
    }

    function reportCurrentCard() {
        const card = currentDeck[currentIndex];
        const issue = prompt("Briefly describe the issue or your question:");
        
        if (issue === null) return; 

        const now = new Date().toLocaleString();
        let body = `FAA Part 107 Question Report\nDate: ${now}\n`;
        body += `Student: ${studentName || "Anonymous"}\n`;
        body += `Class: ${studentClass || "N/A"}\n\n`;
        body += `--- QUESTION DETAILS ---\n`;
        body += `ID: ${card.id}\n`;
        body += `Category: ${card.category}\n`;
        body += `ACS Code: ${card.acs || "N/A"}\n`;
        body += `Question: ${card.question}\n`;
        body += `Answer: ${card.answer}\n\n`;
        body += `--- STUDENT COMMENT ---\n`;
        body += `${issue}\n`;

        document.getElementById('reportText').value = body;
        document.getElementById('reportEmailDisplay').textContent = teacherEmail;
        document.getElementById('reportTitle').textContent = "Report Question Issue";
        document.getElementById('reportModal').style.display = 'block';

        const subject = encodeURIComponent(`Question Report: ID ${card.id} - ${studentName}`);
        const bodyEncoded = encodeURIComponent(body);
        try {
            window.location.href = `mailto:${teacherEmail}?subject=${subject}&body=${bodyEncoded}`;
        } catch (e) { console.log("Mailto failed"); }
    }

    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    function copyToClipboard() {
        const copyText = document.getElementById("reportText");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("Report copied to clipboard! You can now paste it into your email.");
        }, (err) => {
            document.execCommand('copy');
            alert("Report copied to clipboard! (Fallback mode)");
        });
    }

    function openModal(event) {
        event.stopPropagation();
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImg");
        modal.style.display = "block";
        modalImg.src = event.target.src;
    }

    function closeModal() {
        document.getElementById("imageModal").style.display = "none";
    }

    function updateStats() {
        document.getElementById('masteredCount').textContent = masteredList.length;
        document.getElementById('totalCount').textContent = questionData.length;
        
        const reviewBtn = document.getElementById('reviewBtn');
        if (!isReviewMode) {
            reviewBtn.textContent = `Review Weak Areas (${reviewList.length})`;
        } else {
            if (reviewBtn.textContent !== "Return to Deck") {
                 reviewBtn.textContent = "Return to Deck";
            }
        }
        updateProgress();
    }

    function updateProgress() {
        const percent = (masteredList.length / questionData.length) * 100;
        document.getElementById('progressBar').style.width = percent + '%';
    }

    function saveProgress() {
        try {
            localStorage.setItem('faa_reviewList', JSON.stringify(reviewList));
            localStorage.setItem('faa_masteredList', JSON.stringify(masteredList));
            localStorage.setItem('faa_starredList', JSON.stringify(starredList)); // Save stars
        } catch (e) {}
    }

    function loadProgress() {
        try {
            const savedReview = localStorage.getItem('faa_reviewList');
            const savedMastered = localStorage.getItem('faa_masteredList');
            const savedStarred = localStorage.getItem('faa_starredList'); // Load stars
            
            if (savedReview) reviewList = JSON.parse(savedReview);
            if (savedMastered) masteredList = JSON.parse(savedMastered);
            if (savedStarred) starredList = JSON.parse(savedStarred);
        } catch (e) {}
    }

    function resetProgress() {
        if(confirm("Reset all progress (Mastered, Review, Stars)?")) {
            reviewList = [];
            masteredList = [];
            starredList = [];
            saveProgress();
            updateStats();
            applyFilters();
        }
    }
</script>

</body>
</html>
